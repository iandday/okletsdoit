{% extends "components/base.html" %}

{% load static %}

{% block title %}Ideas{% endblock %}
{% block extra_head %}
    {{ form.media }}
{% endblock extra_head %}
{% block content %}
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Header Section -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-base-content mb-4">Wedding Ideas</h1>
            <p class="text-lg text-base-content/70">Capture and organize your creative wedding planning ideas</p>
        </div>
        <!-- Ideas Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for idea in ideas %}
                <div class="card bg-neutral shadow-xl hover:shadow-2xl transition-shadow duration-300">
                    <div class="card-body">
                        <!-- Idea Header -->
                        <div class="flex items-start justify-between mb-4">
                            <h2 class="card-title text-primary">{{ idea.name }}</h2>
                            <div class="flex items-center gap-2">
                                <!-- Edit Button -->
                                <button class="btn btn-ghost btn-xs btn-circle"
                                        id="show-edit-modal-{{ idea.id }}"
                                        title="Edit idea">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         class="h-4 w-4"
                                         fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </button>
                                <!-- Delete Button -->
                                <button class="btn btn-ghost btn-xs btn-circle text-error hover:bg-error hover:text-error-content"
                                        id="show-delete-modal-{{ idea.id }}"
                                        title="Delete idea">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         class="h-4 w-4"
                                         fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1-1H8a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <!-- Description Preview -->
                        {% if idea.description %}
                            <div class="prose prose-sm max-w-none text-base-content/80 mb-4">{{ idea.description|safe|truncatewords:20 }}</div>
                        {% else %}
                            <p class="text-base-content/60 italic mb-4">No description available</p>
                        {% endif %}
                        <!-- Idea Meta -->
                        <div class="text-xs text-base-content/60 mb-4">
                            <div class="flex justify-between">
                                <span>Created: {{ idea.created_at|date:"M d, Y" }}</span>
                                {% if idea.updated_at != idea.created_at %}<span>Updated: {{ idea.updated_at|date:"M d, Y" }}</span>{% endif %}
                            </div>
                            <div class="mt-1">By: {{ idea.created_by.get_full_name|default:idea.created_by.email }}</div>
                        </div>
                        <!-- Card Actions -->
                        <div class="card-actions justify-between items-center">
                            <button class="btn btn-primary btn-sm">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     class="h-4 w-4"
                                     fill="none"
                                     viewBox="0 0 24 24"
                                     stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                                View Details
                            </button>
                            <div class="badge badge-outline badge-sm">{{ idea.name|length }} chars</div>
                        </div>
                    </div>
                </div>
            {% empty %}
                <!-- Empty State -->
                <div class="col-span-full">
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body text-center py-16">
                            <div class="text-6xl mb-4">ðŸ’¡</div>
                            <h2 class="card-title text-2xl justify-center mb-4">No Ideas Yet</h2>
                            <p class="text-base-content/70 mb-6">Start capturing your creative wedding planning ideas!</p>
                            <div class="card-actions justify-center">
                                <button class="btn btn-primary btn-lg" id="show-add-idea-modal">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         class="h-5 w-5"
                                         fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                    </svg>
                                    Create First Idea
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        <!-- Add New Idea Button -->
        <div class="text-center mt-8">
            <button class="btn btn-outline btn-primary" id="show-add-idea-modal">
                <svg xmlns="http://www.w3.org/2000/svg"
                     class="h-5 w-5"
                     fill="none"
                     viewBox="0 0 24 24"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                Add New Idea
            </button>
        </div>
    </div>
    <!-- Add New Idea Modal -->
    <dialog id="addIdeaModal" class="modal">
        <div class="modal-box">
            <h3 class="text-lg font-bold text-primary">Add New Idea</h3>
            <form method="post" action="{% url 'idea_create' %}" class="space-y-4">
                {% csrf_token %}
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-medium">{{ add_idea_form.name.label }}</span>
                    </label>
                    {{ add_idea_form.name }}
                    {% if add_idea_form.name.errors %}
                        <div class="label">
                            {% for error in add_idea_form.name.errors %}<span class="label-text-alt text-error">{{ error }}</span>{% endfor %}
                        </div>
                    {% endif %}
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-medium">{{ add_idea_form.description.label }}</span>
                    </label>
                    {{ add_idea_form.description }}
                    {% if add_idea_form.description.errors %}
                        <div class="label">
                            {% for error in add_idea_form.description.errors %}
                                <span class="label-text-alt text-error">{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <div class="modal-action">
                    <button type="button" class="btn btn-ghost" id="close-add-idea-modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             class="h-4 w-4"
                             fill="none"
                             viewBox="0 0 24 24"
                             stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        Create Idea
                    </button>
                </div>
            </form>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>
{% endblock content %}
{% block extra_script %}
    <script nonce="{{ request.csp_nonce }}">
      document.addEventListener('DOMContentLoaded', function() {
        const showModalButtons = document.querySelectorAll('#show-add-idea-modal');
        const modal = document.getElementById('addIdeaModal');
        const closeModalButton = document.getElementById('close-add-idea-modal');

        showModalButtons.forEach(button => {
          button.addEventListener('click', function() {
            modal.showModal();
          });
        });

        closeModalButton.addEventListener('click', function() {
          modal.close();
        });
      });
    </script>
{% endblock %}
