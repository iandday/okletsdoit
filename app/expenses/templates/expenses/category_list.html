{% extends "components/layout/base.html" %}

{% load static form_extras %}

{% block title %}
    Expense Categories
{% endblock title %}
{% block content %}
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Header Section -->
        <div class="breadcrumbs mb-4">
            <ul>
                <li>
                    <a href="{% url 'expenses:summary' %}" class="link">Expenses</a>
                </li>
                <li>Categories</li>
            </ul>
        </div>
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4">
            <div>
                <h1 class="text-4xl font-bold text-base-content mb-2">Expense Categories</h1>
                <p class="text-lg text-base-content/70">Manage your wedding expense categories</p>
            </div>
            <a href="{% url 'expenses:category_create' %}" class="btn btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg"
                     class="h-5 w-5"
                     fill="none"
                     viewBox="0 0 24 24"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                Add Category
            </a>
        </div>
        <!-- Categories Grid -->
        {% if categories %}
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for category in categories %}
                    <div class="list-card">
                        <div class="list-card-body">
                            <div class="flex items-start justify-between">
                                <a class="list-card-title"
                                   href="{% url 'expenses:category_detail' category.slug %}">{{ category.name }} ({{ category.expense_set.count }} Expenses)</a>
                                <!-- list card options menu-->
                                {% url "expenses:category_detail" category.slug as detail_action %}
                                {% url 'expenses:category_edit' category.slug as update_action %}

                                {% include "shared_helpers/card/list_card_options.html" with slug=category.slug %}

                            </div>
                            {% if category.description %}<p class="text-sm">{{ category.description|truncatechars:100 }}</p>{% endif %}
                            <div class="card-actions justify-end mt-4">
                                <a href="{% url 'expenses:list' %}?category={{ category.slug }}"
                                   class="btn btn-outline btn-sm">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         class="h-4 w-4"
                                         fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                    </svg>
                                    View Expenses
                                </a>
                            </div>
                            <!-- Meta Information -->
                            <div class="text-xs mt-2">Created {{ category.created_at|date:"M j, Y" }}</div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- Empty State -->
            <div class="text-center py-16">
                <div class="text-6xl mb-6">ðŸ“‚</div>
                <h3 class="text-3xl font-bold mb-4">No Categories Yet</h3>
                <p class="text-lg text-base-content/70 mb-8">
                    Create your first expense category to get started organizing your wedding expenses
                </p>
                <a href="{% url 'expenses:category_create' %}"
                   class="btn btn-primary btn-lg">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         class="h-6 w-6"
                         fill="none"
                         viewBox="0 0 24 24"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Create First Category
                </a>
            </div>
        {% endif %}
        <!-- Quick Actions -->
        <div class="text-center mt-12">
            <div class="join">
                <a href="{% url 'expenses:list' %}" class="btn btn-outline join-item">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         class="h-5 w-5"
                         fill="none"
                         viewBox="0 0 24 24"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                    </svg>
                    View All Expenses
                </a>
                <a href="{% url 'expenses:summary' %}" class="btn btn-outline join-item">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         class="h-5 w-5"
                         fill="none"
                         viewBox="0 0 24 24"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    Expense Summary
                </a>
            </div>
        </div>
        <!-- Delete Category Modal-->

        {% include "shared_helpers/modal/object_delete_shell.html" %}

    </div>
{% endblock content %}
{% block extra_script %}
    <script nonce="{{ request.csp_nonce }}">
      document.addEventListener('DOMContentLoaded', function() {

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
          const dropdowns = document.querySelectorAll('.dropdown');
          dropdowns.forEach(dropdown => {
            if (!dropdown.contains(e.target)) {
              const details = dropdown.querySelector('details');
              if (details) {
                details.removeAttribute('open');
              }
            }
          });
        });
      });
    </script>
    <!-- Delete Modal Functionality-->
    {% url "expenses:category_delete_modal" as delete_modal_url %}

    {% include "shared_helpers/modal/object_delete_script.html" %}

{% endblock extra_script %}
