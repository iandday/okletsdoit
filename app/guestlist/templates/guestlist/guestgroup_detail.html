{% extends "components/layout/base.html" %}

{% load static %}

{% block title %}
    {{ guest_group.name }} - Guest Group Details
{% endblock title %}
{% block content %}
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Page Header -->
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
            <div>
                <nav class="text-sm breadcrumbs mb-2">
                    <ul>
                        <li>
                            <a href="{% url 'guestlist:guestlist_summary' %}"
                               class="link link-hover">Guest Lists</a>
                        </li>
                        <li class="text-base-content">{{ guest_group.name }}</li>
                    </ul>
                </nav>
                <h1 class="text-3xl font-bold text-base-content mb-2">{{ guest_group.name }}</h1>
                <div class="flex flex-wrap gap-2 mb-2">
                    {% if guest_group.relationship == "Rel" %}
                        <div class="badge badge-primary">Family</div>
                    {% elif guest_group.relationship == "Fri" %}
                        <div class="badge badge-secondary">Friend</div>
                    {% elif guest_group.relationship == "Col" %}
                        <div class="badge badge-accent">Colleague</div>
                    {% endif %}
                    {% if guest_group.priority == 3 %}
                        <div class="badge badge-error">High Priority</div>
                    {% elif guest_group.priority == 2 %}
                        <div class="badge badge-warning">Medium Priority</div>
                    {% else %}
                        <div class="badge badge-info">Low Priority</div>
                    {% endif %}
                </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-2 mt-4 sm:mt-0">
                <a href="{% url 'guestlist:guest_create_for_group' guest_group.slug %}"
                   class="btn btn-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         class="h-5 w-5"
                         fill="none"
                         viewBox="0 0 24 24"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                    </svg>
                    Add Guest
                </a>
                <a href="{% url 'guestlist:guestgroup_edit' guest_group.slug %}"
                   class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         class="h-5 w-5"
                         fill="none"
                         viewBox="0 0 24 24"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                    Edit Group
                </a>
                <a href="{% url 'guestlist:guestgroup_delete' guest_group.slug %}"
                   class="btn btn-error">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         class="h-5 w-5"
                         fill="none"
                         viewBox="0 0 24 24"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    Delete Group
                </a>
            </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Group Information -->
            <div class="lg:col-span-1">
                <div class="list-card">
                    <div class="card-body">
                        <h2 class="list-card-title text-lg">Group Information</h2>
                        <!-- Contact Information -->
                        {% if guest_group.email or guest_group.phone %}
                            <div class="divider">Contact</div>
                            {% if guest_group.email %}
                                <div class="flex items-center gap-2 mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         class="h-4 w-4"
                                         fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                    </svg>
                                    <a href="mailto:{{ guest_group.email }}" class="link link-hover text-sm">{{ guest_group.email }}</a>
                                </div>
                            {% endif %}
                            {% if guest_group.phone %}
                                <div class="flex items-center gap-2 mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         class="h-4 w-4"
                                         fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                    </svg>
                                    <a href="tel:{{ guest_group.phone }}" class="link link-hover text-sm">{{ guest_group.phone }}</a>
                                </div>
                            {% endif %}
                        {% endif %}
                        <!-- Address Information -->
                        {% if guest_group.address or guest_group.city or guest_group.state %}
                            <div class="divider">Address</div>
                            <div class="text-sm">
                                {% if guest_group.address %}<div>{{ guest_group.address }}</div>{% endif %}
                                {% if guest_group.city or guest_group.state %}
                                    <div>
                                        {% if guest_group.city %}{{ guest_group.city }}{% endif %}
                                        {% if guest_group.city and guest_group.state %},{% endif %}
                                        {% if guest_group.state %}{{ guest_group.state }}{% endif %}
                                        {% if guest_group.zip_code %}{{ guest_group.zip_code }}{% endif %}
                                    </div>
                                {% endif %}
                            </div>
                        {% endif %}
                        <!-- Associated With -->
                        {% if guest_group.associated_with %}
                            <div class="divider">Associated With</div>
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     class="h-4 w-4"
                                     fill="none"
                                     viewBox="0 0 24 24"
                                     stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                                <span class="text-sm">{{ guest_group.associated_with.email }}</span>
                            </div>
                        {% endif %}
                        <!-- Notes -->
                        {% if guest_group.notes %}
                            <div class="divider">Notes</div>
                            <div class="text-sm">{{ guest_group.notes|linebreaks }}</div>
                        {% endif %}
                        <!-- Statistics -->
                        <div class="divider">Statistics</div>
                        <div class="flex justify-between items-center mb-4">
                            <div class="flex gap-2">
                                <div class="badge badge-neutral">Total: {{ guest_group.group_count }}</div>
                                {% if guest_group.group_invited_count > 0 %}
                                    <div class="badge badge-neutral">Invited: {{ guest_group.group_invited_count }}</div>
                                {% endif %}
                                {% if guest_group.group_overnight > 0 %}
                                    <div class="badge badge-neutral">Overnight: {{ guest_group.group_overnight }}</div>
                                {% endif %}
                                {% if guest_group.group_attending_count > 0 %}
                                    <div class="badge badge-neutral">Attending: {{ guest_group.group_attending_count }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <!-- RSVP Progress -->
                        {% if guest_group.group_count > 0 %}
                            {% widthratio guest_group.group_attending_count guest_group.group_count 100 as attendance_percentage %}
                            <div class="mt-4">
                                <div class="flex justify-between text-sm mb-1">
                                    <span>RSVP Progress</span>
                                    <span>{{ attendance_percentage }}%</span>
                                </div>
                                <progress class="progress progress-primary w-full"
                                          value="{{ attendance_percentage }}"
                                          max="100"></progress>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- Guests List -->
            <div class="lg:col-span-2">
                <div class="associated-card">
                    <div class="associated-card-body">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="associated-card-title">Guests ({{ guest_group.group_count }})</h2>
                        </div>
                        {% if guest_group.guests.count > 0 %}
                            <div class="overflow-x-auto">
                                <table class="associated-table">
                                    <thead>
                                        <tr>
                                            <th class="associated-table-header">Name</th>
                                            <th class="associated-table-header">Status</th>
                                            <th class="associated-table-header">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for guest in guest_group.guests.all %}
                                            {% if not guest.is_deleted %}
                                                <tr>
                                                    <td>
                                                        <a href="{% url 'guestlist:guest_detail' guest.slug %}"
                                                           class="font-bold link link-hover">
                                                            {{ guest.first_name }} {{ guest.last_name }}
                                                        </a>
                                                    </td>
                                                    <td>
                                                        {% if guest.responded %}
                                                            {% if guest.is_attending %}
                                                                <div class="badge badge-success gap-2">Attending</div>
                                                            {% else %}
                                                                <div class="badge badge-danger gap-2">Not Attending</div>
                                                            {% endif %}
                                                        {% elif guest.is_invited %}
                                                            <div class="badge badge-warning gap-2">Invited</div>
                                                        {% else %}
                                                            <div class="badge badge-ghost gap-2">Not Invited</div>
                                                        {% endif %}
                                                        {% if guest.overnight %}<div class="badge badge-info gap-2">Overnight</div>{% endif %}
                                                        {% if guest.plus_one %}<div class="badge badge-success gap-2">Plus One</div>{% endif %}
                                                    </td>
                                                    <td>
                                                        <div class="flex gap-1">
                                                            <a href="{% url 'guestlist:guest_detail' guest.slug %}"
                                                               class="btn btn-ghost btn-xs"
                                                               title="View Details">
                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                     class="h-4 w-4"
                                                                     fill="none"
                                                                     viewBox="0 0 24 24"
                                                                     stroke="currentColor">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                                                </svg>
                                                            </a>
                                                            <a href="{% url 'guestlist:guest_edit' guest.slug %}"
                                                               class="btn btn-ghost btn-xs"
                                                               title="Edit Guest">
                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                     class="h-4 w-4"
                                                                     fill="none"
                                                                     viewBox="0 0 24 24"
                                                                     stroke="currentColor">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                                </svg>
                                                            </a>
                                                            <a href="{% url 'guestlist:guest_delete' guest.slug %}"
                                                               class="btn btn-ghost btn-xs text-error"
                                                               title="Delete Guest">
                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                     class="h-4 w-4"
                                                                     fill="none"
                                                                     viewBox="0 0 24 24"
                                                                     stroke="currentColor">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                                </svg>
                                                            </a>
                                                        </div>
                                                    </td>
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <!-- Empty State -->
                            <div class="text-center py-12">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     class="h-16 w-16 mx-auto text-base-content/30 mb-4"
                                     fill="none"
                                     viewBox="0 0 24 24"
                                     stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                                <h3 class="text-lg font-medium text-base-content mb-2">No Guests Yet</h3>
                                <p class="text-base-content/70 mb-4">Start by adding guests to this group.</p>
                                <a href="#" class="btn btn-primary">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         class="h-5 w-5"
                                         fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                    </svg>
                                    Add First Guest
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
