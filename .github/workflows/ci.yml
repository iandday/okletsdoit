name: CI

on:
  push:
    branches-ignore:
      - main
    tags-ignore:
      - '*'
  pull_request:
    branches:
      - main

jobs:
  build-css:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name: Install Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install npm dependencies
        run: |
          npm install

      - name: Build CSS
        run: |
          npm run build-css-ci
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name: "Set up Python"
        uses: actions/setup-python@v5
        with:
          python-version-file: ".python-version"

      - name: Install uv
        uses: astral-sh/setup-uv@v6
        with:
            enable-cache: true

      - name: Install the project
        run: uv sync --locked --all-extras --dev

      - name: Lint (ruff)
        run: |
          uv run --group dev ruff check .

      - name: Minimize uv cache
        run: uv cache prune --ci
#   test:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v5   

#       - name: "Set up Python"
#         uses: actions/setup-python@v5
#         with:
#           python-version-file: ".python-version"

#       - name: Install uv
#         uses: astral-sh/setup-uv@v6
#         with:
#             enable-cache: true

#       - name: Install the project
#         run: uv sync --locked --all-extras --dev

    #   - name: Run tests
    #     run: |
    #       uv run --group dev pytest

    #   - name: Type check (mypy)
    #     working-directory: 'app'
    #     run: |
    #       cd app
    #       uv run --group dev mypy .

    #   - name: Minimize uv cache
    #     run: uv cache prune --ci
  build-docs:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v5   

      - name: "Set up Python"
        uses: actions/setup-python@v5
        with:
          python-version-file: ".python-version"

      - name: Install uv
        uses: astral-sh/setup-uv@v6
        with:
            enable-cache: true

      - name: Install the project
        run: uv sync --locked --all-extras --dev

      - name: Build docs
        working-directory: 'docs'
        run: |
          uv run --all-groups --inexact mkdocs build --clean

      - name: Minimize uv cache
        run: uv cache prune --ci